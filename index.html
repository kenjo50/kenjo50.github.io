<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>eLogbuch Chatbot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h2 {
            color: #003366;
        }

        #chatbox {
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .nachricht-nutzer {
            background: #003366;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            text-align: right;
        }

        .nachricht-bot {
            background: #e8e8e8;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
        }

        #eingabe-bereich {
            display: flex;
            gap: 10px;
        }

        #frage {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
        }

        button {
            padding: 10px 20px;
            background: #003366;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background: #004999;
        }
    </style>
</head>
<body>

    <h2>eLogbuch Assistent</h2>
    <div id="chatbox"></div>

    <div id="eingabe-bereich">
        <input type="text" id="frage" placeholder="Stelle eine Frage zum eLogbuch..." />
        <button onclick="frageSenden()">Senden</button>
    </div>

    <script>
        // ⚠️ Nur für privates Lernprojekt!
        const API_KEY = "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";

        const SYSTEM_PROMPT = `Du bist ein hilfreicher Assistent für das eLogbuch 
        der Bundesärztekammer. Du hilfst Ärzten in Weiterbildung (WBA) und 
        Weiterbildungsbefugten (WBB) bei Fragen rund um das eLogbuch.
        Antworte immer auf Deutsch und halte deine Antworten kurz und klar.
        Wenn du etwas nicht weißt, sage das ehrlich.`;

        let verlauf = [];

        async function frageSenden() {
            const eingabe = document.getElementById("frage");
            const frage = eingabe.value.trim();

            if (!frage) return;

            // Nutzerfrage anzeigen
            nachrichtAnzeigen(frage, "nutzer");
            eingabe.value = "";

            // Zum Verlauf hinzufügen
            verlauf.push({
                role: "user",
                content: frage
            });

            // Ladeanzeige
            nachrichtAnzeigen("...", "bot", "laden");

            try {
                const antwort = await claudeFragen(frage);

                // Ladeanzeige entfernen
                document.getElementById("laden").remove();

                // Antwort anzeigen
                nachrichtAnzeigen(antwort, "bot");

                // Antwort zum Verlauf hinzufügen
                verlauf.push({
                    role: "assistant",
                    content: antwort
                });

            } catch (fehler) {
                document.getElementById("laden").remove();
                nachrichtAnzeigen("Fehler: " + fehler.message, "bot");
            }
        }

        async function claudeFragen() {
            const response = await fetch("https://api.anthropic.com/v1/messages", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "x-api-key": API_KEY,
                    "anthropic-version": "2023-06-01",
                    "anthropic-dangerous-direct-browser-access": "true"
                },
                body: JSON.stringify({
                    model: "claude-haiku-4-5-20251001",
                    max_tokens: 1024,
                    system: SYSTEM_PROMPT,
                    messages: verlauf
                })
            });

            if (!response.ok) {
                throw new Error("API Fehler: " + response.status);
            }

            const daten = await response.json();
            return daten.content[0].text;
        }

        function nachrichtAnzeigen(text, von, id = "") {
            const chatbox = document.getElementById("chatbox");
            const div = document.createElement("div");
            div.className = von === "nutzer" ? "nachricht-nutzer" : "nachricht-bot";
            div.textContent = text;
            if (id) div.id = id;
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Senden mit Enter-Taste
        document.getElementById("frage").addEventListener("keypress", function(e) {
            if (e.key === "Enter") frageSenden();
        });
    </script>

</body>
</html>
